---
title: "ESM 204 HW 3"
author: "Hannah Brady and Janelle Gaun"
date: "5/6/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(ggpubr)
library(broom)
library(knitr)
options(scipen=999)
```


# Part 1

*One gallon of gasoline emits 19.6 pounds of CO^2^. Assuming that the interim Social COst of Carbon (SCC) correctly reflects the total social cost of one metric ton of CO^2^, what is the marginal externality cost (MEC) per gallon of gas?*

The Biden Administration's "interim" value of the SCC is $51 per metric ton of CO2.

```{r, echo = FALSE, message = FALSE, warning = FALSE}

# Calculate and save MEC of one gallon of gas

# MEC = ($/ metric ton) * (metric tons/lb) * (lb/gal)

MEC <- 51*(1/2204.62)*(19.6)

```

The MEC can be calculated as follows:

MEC~gal~ = \$51/metric ton CO~2~ * (1 ton/ 2204.64 lbs) * (19.6 lb CO~2~/gal of gas) = \$`r round(MEC,2)` per gallon of gas

# Part 2

*What is the aggregate daily demand curve for gasoline? What is the supply curve for gasoline? What is the "benefit" to consumers under the status quo? What is the "benefit" to producers under the status quo? What is the environmental cost under the status quo?*

## Aggregate daily demand curve

Data provided includes price (in \$) and quantity (in gallons) estimates of demand per day for "high" and "low" income groups.

```{r, echo = FALSE, message = FALSE, warning = FALSE}

# Read in data
data <- read_csv("HW3_data.csv")

# Create 2 linear models
D_low_lm = lm(Price_Dollars ~ Q_Low_Gallons, data = data)
D_high_lm = lm(Price_Dollars ~ Q_High_Gallons, data = data)

# Create plot for reference
ggplot(data = data) +
  #Low Demand
  geom_point(aes(x = Q_Low_Gallons, y = Price_Dollars, color = "Low"), size = 3, alpha = 0.5) +
  geom_smooth(aes(x = Q_Low_Gallons, y = Price_Dollars, color = "Low"), method = "lm", se = F)+
  #High Demand
  geom_point(aes(x = Q_High_Gallons, y = Price_Dollars, color = "High"), size = 3, alpha = 0.5) +
  geom_smooth(aes(x = Q_High_Gallons, y = Price_Dollars, color = "High"), method = "lm", se = F)+
  labs(x = "Quantity gas (Gallons)", y = "Marginal cost ($/gal)")+
  theme_light()

# Save intercepts
int_low <- D_low_lm$coefficients[[1]]
m_low <- D_low_lm$coefficients[[2]]

int_high <- D_high_lm$coefficients[[1]]
m_high <- D_high_lm$coefficients[[2]]

```

Data points are fit with a linear model to create the following estimates of demand curves by income group:


D~low~ = `r round(m_low,6)`Q + `r round(int_low,1)`

D~high~ = `r round(m_high,6)`Q + `r round(int_high,1)`


Aggregate demand curve is created by horizontally summing individual demand curves. This is done by solving each equation for Q, adding both equations together, and re-solving for P. The resulting equation is valid for the range of prices where both high and low consumers have demand. The aggregate demand equals the demand for the high demand consumer group at prices where only the high demand consumer group has demand: 

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Solve for intercepts for aggregate demand
m_agg <- 1/(1/(m_low)+1/(m_high))
int_agg <- ((int_low/m_low)+(int_high/m_high))/(1/(m_low)+1/(m_high))

# Create functions for all three demand curves
D_low <- function(Q) {m_low*Q + int_low}
D_high <- function(Q) {m_high*Q + int_high}
D_agg <- function(Q) {m_agg*Q + int_agg}
```


D~agg~ , P < `r round(int_low,1)` = `r round(m_agg,6)`Q + `r round(int_agg,1)`

D~agg~ , P > `r round(int_low,1)` = `r round(m_high,6)`Q + `r round(int_high,1)`

## Supply Curve

We are given that:

+ the current gas price (without any taxes) is \$3.00 per gallon, i.e. P~eq~ = \$3/gal
+ the marginal cost of producing a gallon of gasoline is linear
+ MC has a price-intercept of 0, i.e. at Q = 0 gal, P = \$0/gal

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Solve for Q eq given P = 3:
P_eq <- 3
Q_eq <- (P_eq-int_agg)/m_agg

# Save slope of supply curve:
m_MC <- P_eq/Q_eq

# Create function for supply curve
MC <- function(Q) {m_MC*Q}
```

Solve for Q~eq~ by solving for Q, given D~agg~ = \$3/gal:

Q~eq~ = `r round(Q_eq,0)` gallons of gasoline

Solve for slope: (rise/run) = (P~eq~ - 0)/(Q~eq~ - 0) = `r round(m_MC,6)`

MC = `r round(m_MC,6)`Q


```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Graph for reference
ggplot(data.frame(Q = c(0, 800000)), aes(x = Q)) +
  stat_function(fun = D_agg, aes(color = "Aggregate Demand")) +
  stat_function(fun = D_low, aes(color = "Low Demand")) +
  stat_function(fun = D_high, aes(color = "High Demand")) +
  stat_function(fun = MC, aes(color = "Supply")) +
  geom_segment(aes(x = 0, y = P_eq, xend = Q_eq, yend = P_eq, color = "Equilibrium"), linetype = 2)+
  geom_segment(aes(x = Q_eq, y = 0, xend = Q_eq, yend = P_eq, color = "Equilibrium"), linetype = 2)+
  scale_x_continuous(name = "Q (Gallons)") +
  scale_y_continuous(name = "P ($/gal)",limits = c(0, NA)) +
  labs(color = "Curve") +
  theme_minimal()
  
```

## Status quo benefits to producers and consumers

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Calculate consumer surplus

# Solve for quantity at kink
Q_kink <- (int_low-int_agg)/m_agg

# Consumer surplus equals area under high demand curve until kink
SQ_CS_1 <- integrate(D_high, lower = 0, upper = Q_kink)

# plus area under agg demand curve after kink until intercept with supply curve
SQ_CS_2 <- integrate(D_agg, lower = Q_kink, upper = Q_eq)

# minus area from price equals 0 to Peq * Qeq
SQ_CS_total <- SQ_CS_1$value + SQ_CS_2$value - Q_eq*P_eq

# Calculate producer surplus

# Solve for area under supply curve:
SQ_PS_1 <- integrate(MC, lower = 0, upper = Q_eq)

# Subtract from Qeq*Peq:
SQ_PS_total <- Q_eq*P_eq - SQ_PS_1$value
```

Consumer surplus under status quo = \$`r round(SQ_CS_total,0)`.


Producer surplus under status quo = \$`r round(SQ_PS_total,0)`.

## Environmental cost under status quo

Under the status quo, the total environmental cost is equal to:

Total Environmental Cost = MEC~gal~ (from Part 1) * Total gallons of gas consumed by society (Q~eq~) = \$`r round(MEC,2)`/gal * `r round(Q_eq,0)` gal of gas = \$`r round(MEC*Q_eq,2)`

# Part 3

*How is the current consumer benefit divided between "high" and "low" income consumers?*

Use the demand curves for the high and low demand to solve for the quantities for each consumer group given the equilibrium price of \$3/gal gas:
```{r, echo = FALSE, message = FALSE, warning = FALSE}

# Low demand:
Q_eq_low <- (P_eq-int_low)/m_low

# High demand:
Q_eq_high <- (P_eq-int_high)/m_high

```

+ Q~[eq low]~ = `r round(Q_eq_low,0)` gallons of gas purchased by low demand consumers

+ Q~[eq high]~ = `r round(Q_eq_high,0)` gallons of gas purchased by high demand consumers

Calculate benefit to each consumer group by integrating under the demand curve from 0 to Q~[eq of group]~ and then subtracting value of P~eq~*Q~[eq of group]~:

```{r, echo = FALSE, message = FALSE, warning = FALSE}

# Low demand
CS_low_1 <- integrate(D_low, lower = 0, upper = Q_eq_low)
CS_low_total <- CS_low_1$value - P_eq*Q_eq_low

# High demand
CS_high_1 <- integrate(D_high, lower = 0, upper = Q_eq_high)
CS_high_total <- CS_high_1$value - P_eq*Q_eq_high

```

+ Consumer surplus of low demand group = \$`r round(CS_low_total,0)`

+ Consumer surplus of high demand group = \$`r round(CS_high_total,0)`


# Part 4 

*Derive the optimal gas tax (in \$ per gallon of gasoline) using the interim SCC. Noting that recent research has shown the poor face a disproportionate share of the impacts from climate change, assume that the climate externality is borne entirely by the "low" income group. What would be the effects of this tax on:*


The tax would be equal to the marginal external cost (MEC)
MEC = $`r round(MEC,2)` per gallon of gas


#### a. The amount of gasoline produced and consumed

Find the marginal social cost of gasoline by vertically aggregating the marginal supply curve and the marginal external cost curves

    MSC =  = `r round(m_MC,6)`Q + `r round(MEC,2)`

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Total Social Cost:
MSC <- function(Q){m_MC*Q + MEC}

#Graph for reference
ggplot(data.frame(Q = c(0, 800000)), aes(x = Q)) +
  stat_function(fun = MC, aes(color = "Maringal Cost")) +
  stat_function(fun= MSC, aes(color = "Marginal Social Cost"))+
  stat_function(fun = D_agg, aes(color = "Agg Demand")) +
  scale_x_continuous(name = "Q (Gallons)") +
  scale_y_continuous(name = "P ($/gal)",limits = c(0, NA)) +
  labs(color = "Curve") +
  theme_minimal()

```


```{r echo = FALSE, message = FALSE, warning = FALSE}
#Find new equilibrium quantity
MSC_Q_eq <- (MEC-int_agg)/(m_agg-m_MC)
``` 
    Socially optimum equilibrium quantity of `r round(MSC_Q_eq,1)` gallons of gas

#### b. The price of gasoline

```{r echo = FALSE, message = FALSE, warning = FALSE}
#Use the new equilibrium quantity to find the price
MSC_P_eq <- (m_MC*MSC_Q_eq+ MEC)
```
  
  Price= \$ `r round(MSC_P_eq,1)` 

#### c. Overall welfare of "high" income consumers

+ Calculate the welfare of "high" income consumer by determining the consumer surplus at the new equilibrium and subtracting the cost of purchasing gas

+ Solve P =`r round(m_high,6)`Q+ `r round(int_high,2)` at the new socially optimum equilibrium price `r round(MSC_P_eq, 2)`

```{r echo = FALSE, message = FALSE, warning = FALSE}
#Quantity purchased at new socially optimal equilibrium 
MSC_Q_eq_high= (MSC_P_eq-int_high)/(m_high)

# High demand
CS_high_MSC <- integrate(D_high, lower = 0, upper = MSC_Q_eq_high)
CS_high_MSC_total <- CS_high_MSC$value - MSC_P_eq*MSC_Q_eq_high
```

    Q= `r round(MSC_Q_eq_high, 2)` gallons

+ Integrate "high" demand curve (`r round(m_high, 6)`Q + `r round(int_high, 2)`) from 0 to `r round(MSC_Q_eq_high, 2)` then subtract the cost of purchasing gas (`r round(MSC_P_eq, 2)`*`r round(MSC_Q_eq_high, 2)`

    Welfare = \$`r round(CS_high_MSC_total,1)` 

#### d. Overall welfare of "low" income consumers

Calculate the welfare to the low income group by determining the consumer surplus at the new equilibrium and subtracting the cost of purchasing gas and the deadweight loss created by shifting from the BAU scenario to the socially optimal equilibrium 

```{r echo = FALSE, message = FALSE, warning = FALSE}
#Quantity purchased at new socially optimal equilibrium 
MSC_Q_eq_low= (MSC_P_eq-int_low)/(m_low)

# consumer surplus
CS_low_MSC <- integrate(D_low, lower = 0, upper = MSC_Q_eq_low)
CS_low_MSC_total <- CS_low_MSC$value - MSC_P_eq*MSC_Q_eq_low

##Find the DWL
#Integrate the MSC from the socially optimal equilibrium to the BAU equilibrium. 
MSC_area <- integrate(MSC, lower = MSC_Q_eq, upper = Q_eq)

#Integrate the aggregate demand curve from the socially optimal equilibrium to the BAU equilibrium 
D_agg_area <- integrate(D_agg, lower = MSC_Q_eq, upper = Q_eq)

#find DWL
DWL <- (MSC_area$value)-(D_agg_area$value)

## Calculate total welfare 
#Subtract the DWL from the consumer surplus identified above

MSC_welfare_low <- (CS_low_MSC_total-DWL)
```

+ Solve P =`r round(m_low,6)`Q+ `r round(int_low,2)` at the new socially optimum equilibrium price `r round(MSC_P_eq, 2)`

    Q= `r round(MSC_Q_eq_low, 2)`gallons

+ Integrate "low" demand curve (`r round(m_low, 6)`Q + `r round(int_low, 2)`) from 0 to `r round(MSC_Q_eq_low, 2)` then subtract the cost of purchasing gas (`r round(MSC_P_eq,2)`*`r round(MSC_Q_eq_low, 2)`

    Consumer Surplus= \$`r round(CS_low_MSC_total,2)`
 
+ Find the dead weight loss (DWL) by integrating the MSC (`r round(m_MC,6)`Q +` r round (MEC, 2)`) and the aggregate demand curve (from `r round(m_agg, 6)`Q +`r round(int_agg,2)`) between `r round(MSC_Q_eq,1)` and `r round(Q_eq,2)`. 

    DWL= \$ `r round(DWL,2)`

+ Subtract the DWL from the consumer surplus to find the total welfare of the "low" income group


    Welfare= \$`r round(MSC_welfare_low,2)`

#### e. Gas producers


```{r echo = FALSE, message = FALSE, warning = FALSE}
#Amount of gas sold 
income <- MSC_P_eq*MSC_Q_eq

#Cost of production
cost <- integrate (MC, lower = 0, upper = MSC_Q_eq)

#Revenue
revenue <- income - cost$value
```

Find the welfare of the producers by finding the total income of generate at the socially optimal equilibrium and subtracting the cost of production. 

+ Income = P*Q
+ Cost: Integrate `r round(m_MC, 6)`Q from 0 to `MEC_Q_eq`
+ Welfare: Income-Cost

Welfare = \$ `r round(revenue, 2)`

#### f. Total environmental damage

Total environmental damage is the MEC curve evaluated at the new socially optimum equilibrium 

```{r echo = FALSE, message = FALSE, warning = FALSE}
#MEC*quantity of gas consumed

TED <- MEC*MSC_Q_eq
```

TED= `r round(MEC, 2)`*Q when Q= `r round(MSC_Q_eq, 2)`

TED= \$`r round(TED,2)`

#### g. Total tax revenue generated

Tax revenue is found by multiplying the MEC= `r round(MEC, 2)` by the quantity consumed Q=`r round(MSC_Q_eq,2)`

ax Revenue = \$ `r round(TED,2)` 



















