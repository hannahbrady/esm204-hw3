---
title: "ESM 204 HW 3"
author: "Hannah Brady and Janelle Gaun"
date: "5/6/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(ggpubr)
library(broom)
library(knitr)
options(scipen=999)
```


# Part 1

*One gallon of gasoline emits 19.6 pounds of CO^2^. Assuming that the interim Social COst of Carbon (SCC) correctly reflects the total social cost of one metric ton of CO^2^, what is the marginal externality cost (MEC) per gallon of gas?*

The Biden Administration's "interim" value of the SCC is $51 per metric ton of CO2.

```{r, echo = FALSE, message = FALSE, warning = FALSE}

# Calculate and save MEC of one gallon of gas

# MEC = ($/ metric ton) * (metric tons/lb) * (lb/gal)

MEC <- 51*(1/2204.62)*(19.6)

```

The MEC can be calculated as follows:

MEC~gal~ = \$51/metric ton CO~2~ * (1 ton/ 2204.64 lbs) * (19.6 lb CO~2~/gal of gas) = \$`r round(MEC,2)` per gallon of gas

# Part 2

*What is the aggregate daily demand curve for gasoline? What is the supply curve for gasoline? What is the "benefit" to consumers under the status quo? What is the "benefit" to producers under the status quo? What is the environmental cost under the status quo?*

## Aggregate daily demand curve

Data provided includes price (in \$) and quantity (in gallons) estimates of demand per day for "high" and "low" income groups.

```{r, echo = FALSE, message = FALSE, warning = FALSE}

# Read in data
data <- read_csv("HW3_data.csv")

# Create 2 linear models
D_low_lm = lm(Price_Dollars ~ Q_Low_Gallons, data = data)
D_high_lm = lm(Price_Dollars ~ Q_High_Gallons, data = data)

# Create plot for reference
ggplot(data = data) +
  #Low Demand
  geom_point(aes(x = Q_Low_Gallons, y = Price_Dollars, color = "Low"), size = 3, alpha = 0.5) +
  geom_smooth(aes(x = Q_Low_Gallons, y = Price_Dollars, color = "Low"), method = "lm", se = F)+
  #High Demand
  geom_point(aes(x = Q_High_Gallons, y = Price_Dollars, color = "High"), size = 3, alpha = 0.5) +
  geom_smooth(aes(x = Q_High_Gallons, y = Price_Dollars, color = "High"), method = "lm", se = F)+
  labs(x = "Quantity gas (Gallons)", y = "Marginal cost ($/gal)")+
  theme_light()

# Save intercepts
int_low <- D_low_lm$coefficients[[1]]
m_low <- D_low_lm$coefficients[[2]]

int_high <- D_high_lm$coefficients[[1]]
m_high <- D_high_lm$coefficients[[2]]

```

Data points are fit with a linear model to create the following estimates of demand curves by income group:


D~low~ = `r round(m_low,6)`Q + `r round(int_low,1)`

D~high~ = `r round(m_high,6)`Q + `r round(int_high,1)`


Aggregate demand curve is created by horizontally summing individual demand curves. This is done by solving each equation for Q, adding both equations together, and re-solving for P. The resulting equation is valid for the range of prices where both high and low consumers have demand. The aggregate demand equals the demand for the high demand consumer group at prices where only the high demand consumer group has demand: 

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Solve for intercepts for aggregate demand
m_agg <- 1/(1/(m_low)+1/(m_high))
int_agg <- ((int_low/m_low)+(int_high/m_high))/(1/(m_low)+1/(m_high))

# Create functions for all three demand curves
D_low <- function(Q) {m_low*Q + int_low}
D_high <- function(Q) {m_high*Q + int_high}
D_agg <- function(Q) {m_agg*Q + int_agg}
```


D~agg~ , P < `r round(int_low,1)` = `r round(m_agg,6)`Q + `r round(int_agg,1)`

D~agg~ , P > `r round(int_low,1)` = `r round(m_high,6)`Q + `r round(int_high,1)`

## Supply Curve

We are given that:

+ the current gas price (without any taxes) is \$3.00 per gallon, i.e. P~eq~ = \$3/gal
+ the marginal cost of producing a gallon of gasoline is linear
+ MC has a price-intercept of 0, i.e. at Q = 0 gal, P = \$0/gal

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Solve for Q eq given P = 3:
P_eq <- 3
Q_eq <- (P_eq-int_agg)/m_agg

# Save slope of supply curve:
m_MC <- P_eq/Q_eq

# Create function for supply curve
MC <- function(Q) {m_MC*Q}
```

Solve for Q~eq~ by solving for Q, given D~agg~ = \$3/gal:

Q~eq~ = `r round(Q_eq,0)` gallons of gasoline

Solve for slope: (rise/run) = (P~eq~ - 0)/(Q~eq~ - 0) = `r round(m_MC,6)`

MC = `r round(m_MC,6)`Q


```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Graph for reference
ggplot(data.frame(Q = c(0, 800000)), aes(x = Q)) +
  stat_function(fun = D_agg, aes(color = "Aggregate Demand")) +
  stat_function(fun = D_low, aes(color = "Low Demand")) +
  stat_function(fun = D_high, aes(color = "High Demand")) +
  stat_function(fun = MC, aes(color = "Supply")) +
  geom_segment(aes(x = 0, y = P_eq, xend = Q_eq, yend = P_eq, color = "Equilibrium"), linetype = 2)+
  geom_segment(aes(x = Q_eq, y = 0, xend = Q_eq, yend = P_eq, color = "Equilibrium"), linetype = 2)+
  scale_x_continuous(name = "Q (Gallons)") +
  scale_y_continuous(name = "P ($/gal)",limits = c(0, NA)) +
  labs(color = "Curve") +
  theme_minimal()
  
```

## Status quo benefits to producers and consumers

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Calculate consumer surplus

# Solve for quantity at kink
Q_kink <- (int_low-int_agg)/m_agg

# Consumer surplus equals area under high demand curve until kink
SQ_CS_1 <- integrate(D_high, lower = 0, upper = Q_kink)

# plus area under agg demand curve after kink until intercept with supply curve
SQ_CS_2 <- integrate(D_agg, lower = Q_kink, upper = Q_eq)

# minus area from price equals 0 to Peq * Qeq
SQ_CS_total <- SQ_CS_1$value + SQ_CS_2$value - Q_eq*P_eq

# Calculate producer surplus

# Solve for area under supply curve:
SQ_PS_1 <- integrate(MC, lower = 0, upper = Q_eq)

# Subtract from Qeq*Peq:
SQ_PS_total <- Q_eq*P_eq - SQ_PS_1$value
```

Consumer surplus under status quo = \$`r round(SQ_CS_total,0)`.


Producer surplus under status quo = \$`r round(SQ_PS_total,0)`.

## Environmental cost under status quo

Under the status quo, the total environmental cost is equal to:

Total Environmental Cost = MEC~gal~ (from Part 1) * Total gallons of gas consumed by society (Q~eq~) = \$`r round(MEC,2)`/gal * `r round(Q_eq,0)` gal of gas = \$`r round(MEC*Q_eq,2)`

# Part 3

*How is the current consumer benefit divided between "high" and "low" income consumers?*

Use the demand curves for the high and low demand to solve for the quantities for each consumer group given the equilibrium price of \$3/gal gas:
```{r, echo = FALSE, message = FALSE, warning = FALSE}

# Low demand:
Q_eq_low <- (P_eq-int_low)/m_low

# High demand:
Q_eq_high <- (P_eq-int_high)/m_high

```

+ Q~[eq low]~ = `r round(Q_eq_low,0)` gallons of gas purchased by low demand consumers

+ Q~[eq high]~ = `r round(Q_eq_high,0)` gallons of gas purchased by high demand consumers

Calculate benefit to each consumer group by integrating under the demand curve from 0 to Q~[eq of group]~ and then subtracting value of P~eq~*Q~[eq of group]~:

```{r, echo = FALSE, message = FALSE, warning = FALSE}

# Low demand
CS_low_1 <- integrate(D_low, lower = 0, upper = Q_eq_low)
CS_low_total <- CS_low_1$value - P_eq*Q_eq_low

# High demand
CS_high_1 <- integrate(D_high, lower = 0, upper = Q_eq_high)
CS_high_total <- CS_high_1$value - P_eq*Q_eq_high

```

+ Consumer surplus of low demand group = \$`r round(CS_low_total,0)`

+ Consumer surplus of high demand group = \$`r round(CS_high_total,0)`


# Part 4 

*Derive the optimal gas tax (in \$ per gallon of gasoline) using the interim SCC. Noting that recent research has shown the poor face a disproportionate share of the impacts from climate change, assume that the climate externality is borne entirely by the "low" income group. What would be the effects of this tax on:*

(a) The amount of gasoline produced and consumed
(b) The price of gasoline
(c) Overall welfare of "high" income consumers
(d) Overall welfare of "low" income consumers
(e) Gas producers
(f) Total environmental damage
(g) Total tax revenue generated
